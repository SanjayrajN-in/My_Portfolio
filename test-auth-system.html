<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Auth System Test</title>
    <link rel="stylesheet" href="frontend/css/styles.css">
    <link rel="stylesheet" href="frontend/css/login-modal.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #1e1e2f, #16213e);
            color: white;
            margin: 0;
            padding: 20px;
        }
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .test-button {
            background: #00a8ff;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }
        .test-button:hover {
            background: #0097e6;
        }
        .status {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
        }
        .success { color: #00d4aa; }
        .error { color: #ff3742; }
        .info { color: #00a8ff; }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üîê Authentication System Test</h1>
        
        <div class="test-section">
            <h2>Login Modal Test</h2>
            <button class="test-button" onclick="testLoginModal()">
                <i class="fas fa-sign-in-alt"></i> Open Login Modal
            </button>
            <button class="test-button" onclick="testAuthStatus()">
                <i class="fas fa-user-check"></i> Check Auth Status
            </button>
            <button class="test-button" onclick="testLogout()">
                <i class="fas fa-sign-out-alt"></i> Logout
            </button>
        </div>
        
        <div class="test-section">
            <h2>API Connection Test</h2>
            <button class="test-button" onclick="testAPIConnection()">
                <i class="fas fa-server"></i> Test API Health
            </button>
            <button class="test-button" onclick="testGoogleAuth()">
                <i class="fab fa-google"></i> Test Google Auth Init
            </button>
        </div>
        
        <div id="status" class="status">
            <h3>System Status</h3>
            <p>Ready to test authentication system...</p>
        </div>
        
        <div id="authInfo" class="status" style="display: none;">
            <h3>Authentication Info</h3>
            <div id="authDetails"></div>
        </div>
    </div>

    <!-- Include auth scripts -->
    <script src="frontend/js/api-config.js"></script>
    <script src="frontend/js/auth.js"></script>
    <script src="frontend/js/login-modal.js"></script>

    <script>
        let statusDiv = document.getElementById('status');
        let authInfoDiv = document.getElementById('authInfo');
        let authDetailsDiv = document.getElementById('authDetails');

        function updateStatus(message, type = 'info') {
            statusDiv.innerHTML = `<h3>System Status</h3><p class="${type}"><i class="fas fa-${type === 'success' ? 'check' : type === 'error' ? 'times' : 'info-circle'}"></i> ${message}</p>`;
        }

        function testLoginModal() {
            updateStatus('Opening login modal...', 'info');
            try {
                if (typeof loginModal !== 'undefined' && loginModal) {
                    loginModal.open();
                    updateStatus('Login modal opened successfully!', 'success');
                } else {
                    updateStatus('Login modal not initialized', 'error');
                }
            } catch (error) {
                updateStatus(`Error opening login modal: ${error.message}`, 'error');
            }
        }

        function testAuthStatus() {
            updateStatus('Checking authentication status...', 'info');
            try {
                const token = localStorage.getItem('token');
                const user = authSystem ? authSystem.currentUser : null;
                
                authInfoDiv.style.display = 'block';
                authDetailsDiv.innerHTML = `
                    <p><strong>Token:</strong> ${token ? '‚úÖ Present' : '‚ùå Not found'}</p>
                    <p><strong>Current User:</strong> ${user ? `‚úÖ ${user.name} (${user.email})` : '‚ùå Not logged in'}</p>
                    <p><strong>Auth System:</strong> ${typeof authSystem !== 'undefined' ? '‚úÖ Loaded' : '‚ùå Not loaded'}</p>
                    <p><strong>Login Modal:</strong> ${typeof loginModal !== 'undefined' ? '‚úÖ Loaded' : '‚ùå Not loaded'}</p>
                `;
                
                updateStatus('Authentication status checked!', 'success');
            } catch (error) {
                updateStatus(`Error checking auth status: ${error.message}`, 'error');
            }
        }

        async function testAPIConnection() {
            updateStatus('Testing API connection...', 'info');
            try {
                const API_BASE_URL = typeof getAPIBaseURL === 'function' ? getAPIBaseURL() : 'http://localhost:3000';
                const response = await fetch(`${API_BASE_URL}/api/health`);
                const data = await response.json();
                
                if (response.ok) {
                    updateStatus(`API connection successful! Server: ${data.message}`, 'success');
                } else {
                    updateStatus(`API error: ${data.message}`, 'error');
                }
            } catch (error) {
                updateStatus(`API connection failed: ${error.message}`, 'error');
            }
        }

        async function testGoogleAuth() {
            updateStatus('Testing Google Auth initialization...', 'info');
            try {
                const API_BASE_URL = typeof getAPIBaseURL === 'function' ? getAPIBaseURL() : 'http://localhost:3000';
                const response = await fetch(`${API_BASE_URL}/api/auth/google/init`);
                const data = await response.json();
                
                if (response.ok) {
                    updateStatus(`Google Auth configured! Client ID available: ${data.clientId ? '‚úÖ' : '‚ùå'}`, 'success');
                } else {
                    updateStatus(`Google Auth error: ${data.message}`, 'error');
                }
            } catch (error) {
                updateStatus(`Google Auth test failed: ${error.message}`, 'error');
            }
        }

        function testLogout() {
            updateStatus('Testing logout...', 'info');
            try {
                if (authSystem && typeof authSystem.logout === 'function') {
                    authSystem.logout();
                    updateStatus('Logout initiated!', 'success');
                } else {
                    updateStatus('AuthSystem logout not available', 'error');
                }
            } catch (error) {
                updateStatus(`Logout error: ${error.message}`, 'error');
            }
        }

        // Initialize test page
        document.addEventListener('DOMContentLoaded', function() {
            updateStatus('Authentication test page loaded successfully!', 'success');
            setTimeout(testAuthStatus, 1000); // Check status after 1 second
        });
    </script>
</body>
</html>